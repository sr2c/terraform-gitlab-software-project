<!-- markdownlint-disable -->
# terraform-gitlab-software-project
[![pipeline status](https://gitlab.com/sr2c/terraform-gitlab-software-project/badges/main/pipeline.svg?ignore_skipped=true&style=flat-square)](https://gitlab.com/sr2c/terraform-gitlab-software-project/-/pipelines)
[![latest release](https://gitlab.com/sr2c/terraform-gitlab-software-project/-/badges/release.svg?style=flat-square)](https://gitlab.com/sr2c/terraform-gitlab-software-project/-/tags)
[![gitlab stars](https://img.shields.io/gitlab/stars/sr2c/terraform-gitlab-software-project?style=flat-square)](https://gitlab.com/sr2c/terraform-gitlab-software-project/-/starrers)
[![gitlab forks](https://img.shields.io/gitlab/forks/sr2c/terraform-gitlab-software-project?style=flat-square)](https://gitlab.com/sr2c/terraform-gitlab-software-project/-/forks)
<!-- markdownlint-restore -->
[![SR2 Communications Limited][logo]](https://www.sr2.uk/)

[![README Header][readme_header_img]][readme_header_link]
<!--

  ** DO NOT EDIT THIS FILE
  **
  ** This file was automatically generated by the `build-harness`.
  ** 1) Make all changes to `README.yaml`
  ** 2) Run `make init` (you only need to do this once)
  ** 3) Run`make readme` to rebuild this file.
  **
  ** (We maintain HUNDREDS of projects. This is how we maintain our sanity.)
  **

-->

GitLab project for a software project with optional GitHub mirror.

---

## Usage
```hcl
terraform {
  required_providers {
    gitlab = {
      source = "gitlabhq/gitlab"
    }
    github = {
      source = "integrations/github"
    }
  }
}

provider "gitlab" {
  token = local.gitlab_token
}
  
provider "github" {
  token = local.github_token
  owner = local.github_organization_name
}

locals {
  gitlab_token             = ""        # Generate this using the instructions below
  gitlab_group_id          = 11925634  # Change this to your organization's GitLab group ID
  github_organization_name = "sr2c"    # Change this to your organization's name
  github_token             = ""        # Generate this using the instructions below
}

module "projects" {
  source        = "sr2c/software-project/gitlab"
  gitlab_group  = local.gitlab_group_id
  name          = "terraform-null-example"
  description   = "An example Terraform module (null provider)"
  github_mirror = true
  github_user   = "ExampleMirrorBot"
  github_token  = local.github_token
}
```

### Generating the GitLab token

To configure GitLab, you will need an access token. GitLab has a variety of scoped access tokens, including
[personal](https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html) and
[group](https://docs.gitlab.com/ee/user/group/settings/group_access_tokens.html) access tokens.
Project-level access tokens cannot be used with this module.
Create the type of token that is suitable according to your threat model.

Add a name so that you will be reminded of the purpose of this token when you go to look at it later.
Your access token will need the “api” scope. The expiry can be set according to your threat model.
GitLab will send an email warning to token owners 7 days before expiry allowing you to generate a new token and
update your configuration.

### Generating the GitHub token

To configure GitHub, you will need a “personal access token”. It is not possible to restrict a token to specific
repositories, so it is best to create a
[machine user](https://docs.github.com/en/developers/overview/managing-deploy-keys#machine-users) and then invite that
user to only the repositories that should be accessed to limit the impact of a token disclosure.

To create a token, visit the [New personal access token](https://github.com/settings/tokens/new) page of the GitHub
settings.
Add a note so that you will be reminded of the purpose of this token when you go to look at it later.
Your access token will need the “repo” OAuth scope.

The expiry can be set according to your threat model. GitHub will
[send an email warning](https://github.blog/changelog/2021-07-26-expiration-options-for-personal-access-tokens/)
before the token expires allowing you to generate a new token and update your configuration.

<!-- markdownlint-disable -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.0.11 |
| <a name="requirement_github"></a> [github](#requirement\_github) | >= 5.15.0 |
| <a name="requirement_gitlab"></a> [gitlab](#requirement\_gitlab) | >= 3.19.0 |
| <a name="requirement_null"></a> [null](#requirement\_null) | >= 3.2 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_github"></a> [github](#provider\_github) | >= 5.15.0 |
| <a name="provider_gitlab"></a> [gitlab](#provider\_gitlab) | >= 3.19.0 |
| <a name="provider_null"></a> [null](#provider\_null) | >= 3.2 |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [github_repository.this](https://registry.terraform.io/providers/integrations/github/latest/docs/resources/repository) | resource |
| [gitlab_project.this](https://registry.terraform.io/providers/gitlabhq/gitlab/latest/docs/resources/project) | resource |
| [gitlab_project_mirror.this](https://registry.terraform.io/providers/gitlabhq/gitlab/latest/docs/resources/project_mirror) | resource |
| [null_resource.trigger_mirror_push](https://registry.terraform.io/providers/hashicorp/null/latest/docs/resources/resource) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_archived"></a> [archived](#input\_archived) | Whether the project is archived | `bool` | `false` | no |
| <a name="input_avatar_path"></a> [avatar\_path](#input\_avatar\_path) | Filesystem path to the project avatar | `string` | `null` | no |
| <a name="input_description"></a> [description](#input\_description) | The project description. | `string` | n/a | yes |
| <a name="input_enabled"></a> [enabled](#input\_enabled) | Set to false to prevent the module from creating any resources. | `bool` | `true` | no |
| <a name="input_github_mirror"></a> [github\_mirror](#input\_github\_mirror) | Create a mirror of this project on GitHub. | `bool` | `false` | no |
| <a name="input_github_token"></a> [github\_token](#input\_github\_token) | The GitHub access token to use for mirroring (required if github\_mirror is true). | `string` | `""` | no |
| <a name="input_github_user"></a> [github\_user](#input\_github\_user) | The GitHub username to use for mirroring (required if github\_mirror is true). | `string` | `""` | no |
| <a name="input_gitlab_group"></a> [gitlab\_group](#input\_gitlab\_group) | The ID of the GitLab group in which to create the project. If this is not specified, it will be created in the personal namespace of the authenticated user. | `number` | `null` | no |
| <a name="input_gitlab_token"></a> [gitlab\_token](#input\_gitlab\_token) | The GitLab access token to use to trigger an initial mirror push. No initial push will happen if null. | `string` | `null` | no |
| <a name="input_issues_template"></a> [issues\_template](#input\_issues\_template) | The template to use for new issues. | `string` | `null` | no |
| <a name="input_merge_requests_template"></a> [merge\_requests\_template](#input\_merge\_requests\_template) | The template to use for new merge requests. | `string` | `null` | no |
| <a name="input_name"></a> [name](#input\_name) | The project name. | `string` | n/a | yes |
| <a name="input_shared_runners"></a> [shared\_runners](#input\_shared\_runners) | Enable shared runners on the GitLab repository. | `bool` | `true` | no |
| <a name="input_visibility"></a> [visibility](#input\_visibility) | The visibility of the project. Allowed values are "public" and "private". This will apply also to the GitHub mirror if specified to be created. | `string` | `"public"` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_github_repository_git_url"></a> [github\_repository\_git\_url](#output\_github\_repository\_git\_url) | The URL to clone from the GitHub mirror using the git protocol, if created. |
| <a name="output_github_repository_web_url"></a> [github\_repository\_web\_url](#output\_github\_repository\_web\_url) | The web URL for the GitHub mirror, if created. |
| <a name="output_gitlab_project_id"></a> [gitlab\_project\_id](#output\_gitlab\_project\_id) | The ID of the GitLab project. |
| <a name="output_gitlab_project_ssh_url"></a> [gitlab\_project\_ssh\_url](#output\_gitlab\_project\_ssh\_url) | The SSH URL to clone/push this GitLab project. |
| <a name="output_gitlab_project_web_url"></a> [gitlab\_project\_web\_url](#output\_gitlab\_project\_web\_url) | The web URL for the GitLab project. |
<!-- markdownlint-restore -->


<!-- markdownlint-disable -->
## Makefile Targets
```text
Available targets:

  help                                Help screen
  help/all                            Display help for all targets
  help/short                          This help short screen
  lint                                Lint terraform code

```
<!-- markdownlint-restore -->

## Share the Love

Like this project? Please give it a ★ on
[our GitLab](https://gitlab.com/sr2c/terraform-gitlab-software-project)!
(it helps us **a lot**)


## References

For additional context, refer to some of these links.

- [GitLab Projects API](https://docs.gitlab.com/ee/api/projects.html) - The API documentation for GitLab projects.
- [GitHub Repositories](https://docs.github.com/en/rest/repos/repos) - The API documentation for GitHub repositories.


## Help

**Got a question?** We got answers.

File a
[GitLab issue](https://gitlab.com/sr2c/terraform-gitlab-software-project/-/issues),
send us an [email][email] or join our [IRC](#irc).

[![README Commercial Support][readme_commercial_support_img]][readme_commercial_support_link]

## IRC

[![IRC badge](https://img.shields.io/badge/libera.chat-%23sr2-blueviolet?style=flat-square)][irc]

Join our [public chat][irc] on IRC.
If you don't have an IRC client already, you can get started with the
[web client](https://web.libera.chat/#sr2).
This is the best place to talk shop, ask questions, solicit feedback, and work
together as a community to build on our open source code.

## Contributing

### Bug Reports & Feature Requests

Please use the
[issue tracker](https://gitlab.com/sr2c/terraform-gitlab-software-project/-/issues)
to report any bugs or file feature requests.

### Developing

If you are interested in being a contributor and want to get involved in
developing this project or help out with our other projects, we would love to
hear from you!
Shoot us an [email][email].

In general, MRs are welcome. We follow the typical "fork-and-pull" Git workflow:

 1. **Fork** the repo on GitLab
 2. **Clone** the project to your own machine
 3. **Commit** changes to your own branch
 4. **Push** your work back up to your fork
 5. Submit a **Merge Request** so that we can review your changes

**NOTE:** Be sure to merge the latest changes from "upstream" before making a
pull request!

We have adopted the
[Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/)
specification for the formatting of commit messages.

## Copyright

Copyright © 2021-2024 SR2 Communications Limited

## Trademarks

All other trademarks referenced herein are the property of their respective owners.

## About

This project is maintained by [SR2 Communications Limited][website].

[![SR2 Communications Limited][logo]][website]

We're a [DevOps services][website] company based in Aberdeen, Scotland. We
specialise in solutions for online freedom, digital sovereignty and
anti-censorship.

We offer [paid support][website] on all of our projects.

Check out [our other projects][gitlab], or [hire us][website] to get support
with using our projects.

## Contributors

<!-- markdownlint-disable -->
|  [![irl][irlxyz_avatar]][irlxyz_homepage]<br/>[irl][irlxyz_homepage] |
|---|

  [irlxyz_homepage]: https://gitlab.com/irlxyz
  [irlxyz_avatar]: https://gitlab.com/uploads/-/system/user/avatar/5895869/avatar.png?width=130

<!-- markdownlint-restore --><!-- markdownlint-disable -->
  [logo]: https://www.sr2.uk/readme/logo.png
  [website]: https://www.sr2.uk/?utm_source=gitlab&utm_medium=readme&utm_campaign=sr2c/terraform-gitlab-software-project&utm_content=website
  [gitlab]: https://go.sr2.uk/gitlab?utm_source=gitlab&utm_medium=readme&utm_campaign=sr2c/terraform-gitlab-software-project&utm_content=gitlab
  [contact]: https://go.sr2.uk/contact?utm_source=gitlab&utm_medium=readme&utm_campaign=sr2c/terraform-gitlab-software-project&utm_content=contact
  [irc]: ircs://libera.chat/sr2
  [linkedin]: https://www.linkedin.com/company/sr2uk/
  [email]: mailto:contact@sr2.uk
  [readme_header_img]: https://www.sr2.uk/readme/paid-support.png
  [readme_header_link]: https://www.sr2.uk/?utm_source=gitlab&utm_medium=readme&utm_campaign=sr2c/terraform-gitlab-software-project&utm_content=readme_header_link
  [readme_commercial_support_img]: https://www.sr2.uk/readme/paid-support.png
  [readme_commercial_support_link]: https://go.sr2.uk/commerical-support?utm_source=gitlab&utm_medium=readme&utm_campaign=sr2c/terraform-gitlab-software-project&utm_content=readme_commercial_support_link
<!-- markdownlint-restore -->
